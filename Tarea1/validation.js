let chile = {

"regiones": [
    {
        "nombre": "Arica y Parinacota",
        "comunas": ["Arica", "Camarones", "Putre", "General Lagos"]
    },
    {
        "nombre": "Tarapacá",
        "comunas": ["Iquique", "Alto Hospicio", "Pozo Almonte", "Camiña", "Colchane", "Huara", "Pica"]
    },
    {
        "nombre": "Antofagasta",
        "comunas": ["Antofagasta", "Mejillones", "Sierra Gorda", "Taltal", "Calama", "Ollagüe", "San Pedro de Atacama", "Tocopilla", "María Elena"]
    },
    {
        "nombre": "Atacama",
        "comunas": ["Copiapó", "Caldera", "Tierra Amarilla", "Chañaral", "Diego de Almagro", "Vallenar", "Alto del Carmen", "Freirina", "Huasco"]
    },
    {
        "nombre": "Coquimbo",
        "comunas": ["La Serena", "Coquimbo", "Andacollo", "La Higuera", "Paiguano", "Vicuña", "Illapel", "Canela", "Los Vilos", "Salamanca", "Ovalle", "Combarbalá", "Monte Patria", "Punitaqui", "Río Hurtado"]
    },
    {
        "nombre": "Valparaíso",
        "comunas": ["Valparaíso", "Casablanca", "Concón", "Juan Fernández", "Puchuncaví", "Quintero", "Viña del Mar", "Isla de Pascua", "Los Andes", "Calle Larga", "Rinconada", "San Esteban", "La Ligua", "Cabildo", "Papudo", "Petorca", "Zapallar", "Quillota", "Calera", "Hijuelas", "La Cruz", "Nogales", "San Antonio", "Algarrobo", "Cartagena", "El Quisco", "El Tabo", "Santo Domingo", "San Felipe", "Catemu", "Llaillay", "Panquehue", "Putaendo", "Santa María", "Quilpué", "Limache", "Olmué", "Villa Alemana"]
    },
    {
        "nombre": "Región del Libertador Gral. Bernardo O’Higgins",
        "comunas": ["Rancagua", "Codegua", "Coinco", "Coltauco", "Doñihue", "Graneros", "Las Cabras", "Machalí", "Malloa", "Mostazal", "Olivar", "Peumo", "Pichidegua", "Quinta de Tilcoco", "Rengo", "Requínoa", "San Vicente", "Pichilemu", "La Estrella", "Litueche", "Marchihue", "Navidad", "Paredones", "San Fernando", "Chépica", "Chimbarongo", "Lolol", "Nancagua", "Palmilla", "Peralillo", "Placilla", "Pumanque", "Santa Cruz"]
    },
    {
        "nombre": "Región del Maule",
        "comunas": ["Talca", "Constítución", "Curepto", "Empedrado", "Maule", "Pelarco", "Pencahue", "Río Claro", "San Clemente", "San Rafael", "Cauquenes", "Chanco", "Pelluhue", "Curicó", "Hualañé", "Licantén", "Molina", "Rauco", "Romeral", "Sagrada Familia", "Teno", "Vichuquén", "Linares", "Colbún", "Longaví", "Parral", "Retíro", "San Javier", "Villa Alegre", "Yerbas Buenas"]
    },
    {
        "nombre": "Región del Biobío",
        "comunas": ["Concepción", "Coronel", "Chiguayante", "Florida", "Hualqui", "Lota", "Penco", "San Pedro de la Paz", "Santa Juana", "Talcahuano", "Tomé", "Hualpén", "Lebu", "Arauco", "Cañete", "Contulmo", "Curanilahue", "Los Álamos", "Tirúa", "Los Ángeles", "Antuco", "Cabrero", "Laja", "Mulchén", "Nacimiento", "Negrete", "Quilaco", "Quilleco", "San Rosendo", "Santa Bárbara", "Tucapel", "Yumbel", "Alto Biobío", "Chillán", "Bulnes", "Cobquecura", "Coelemu", "Coihueco", "Chillán Viejo", "El Carmen", "Ninhue", "Ñiquén", "Pemuco", "Pinto", "Portezuelo", "Quillón", "Quirihue", "Ránquil", "San Carlos", "San Fabián", "San Ignacio", "San Nicolás", "Treguaco", "Yungay"]
    },
    {
        "nombre": "Región de la Araucanía",
        "comunas": ["Temuco", "Carahue", "Cunco", "Curarrehue", "Freire", "Galvarino", "Gorbea", "Lautaro", "Loncoche", "Melipeuco", "Nueva Imperial", "Padre las Casas", "Perquenco", "Pitrufquén", "Pucón", "Saavedra", "Teodoro Schmidt", "Toltén", "Vilcún", "Villarrica", "Cholchol", "Angol", "Collipulli", "Curacautín", "Ercilla", "Lonquimay", "Los Sauces", "Lumaco", "Purén", "Renaico", "Traiguén", "Victoria"]
    },
    {
        "nombre": "Región de Los Ríos",
        "comunas": ["Valdivia", "Corral", "Lanco", "Los Lagos", "Máfil", "Mariquina", "Paillaco", "Panguipulli", "La Unión", "Futrono", "Lago Ranco", "Río Bueno"]
    },
    {
        "nombre": "Región de Los Lagos",
        "comunas": ["Puerto Montt", "Calbuco", "Cochamó", "Fresia", "Frutíllar", "Los Muermos", "Llanquihue", "Maullín", "Puerto Varas", "Castro", "Ancud", "Chonchi", "Curaco de Vélez", "Dalcahue", "Puqueldón", "Queilén", "Quellón", "Quemchi", "Quinchao", "Osorno", "Puerto Octay", "Purranque", "Puyehue", "Río Negro", "San Juan de la Costa", "San Pablo", "Chaitén", "Futaleufú", "Hualaihué", "Palena"]
    },
    {
        "nombre": "Región Aisén del Gral. Carlos Ibáñez del Campo",
        "comunas": ["Coihaique", "Lago Verde", "Aisén", "Cisnes", "Guaitecas", "Cochrane", "O’Higgins", "Tortel", "Chile Chico", "Río Ibáñez"]
    },
    {
        "nombre": "Región de Magallanes y de la Antártíca Chilena",
        "comunas": ["Punta Arenas", "Laguna Blanca", "Río Verde", "San Gregorio", "Cabo de Hornos (Ex Navarino)", "Antártíca", "Porvenir", "Primavera", "Timaukel", "Natales", "Torres del Paine"]
    },
    {
        "nombre": "Región Metropolitana de Santiago",
        "comunas": ["Cerrillos", "Cerro Navia", "Conchalí", "El Bosque", "Estación Central", "Huechuraba", "Independencia", "La Cisterna", "La Florida", "La Granja", "La Pintana", "La Reina", "Las Condes", "Lo Barnechea", "Lo Espejo", "Lo Prado", "Macul", "Maipú", "Ñuñoa", "Pedro Aguirre Cerda", "Peñalolén", "Providencia", "Pudahuel", "Quilicura", "Quinta Normal", "Recoleta", "Renca", "San Joaquín", "San Miguel", "San Ramón", "Vitacura", "Puente Alto", "Pirque", "San José de Maipo", "Colina", "Lampa", "Tiltíl", "San Bernardo", "Buin", "Calera de Tango", "Paine", "Melipilla", "Alhué", "Curacaví", "María Pinto", "San Pedro", "Talagante", "El Monte", "Isla de Maipo", "Padre Hurtado", "Peñaflor"]
    }]
};
let comidas = [ "Al Paso",
"Alemana", "Árabe",
"Argentina", "Asiática",
"Australiana",
"Brasileña", "Café y Snacks", "Carnes",
"Casera", "Chilena",
"China", "Cocina de Autor", "Comida Rápida", "Completos",
"Coreana", "Cubana",
"Española", "Exótica",
"Francesa", "Gringa",
"Hamburguesa",
"Helados", "India",
"Internacional",
"Italiana",
"Latinoamericana",
"Mediterránea",
"Mexicana", "Nikkei",
"Parrillada", "Peruana",
"Pescados y mariscos", "Picoteos",
"Pizzas", "Pollos y Pavos", "Saludable",
"Sándwiches", "Suiza",
"Japonesa", "Sushi",
"Tapas", "Thai", "Vegana",
"Vegetariana"
]

let listOfEvents = true;
let data = true;
let notify = true;


let F = 0;
// Adds an input element of image type
// at a certain div
function AddPhoto(){
    let container = document.getElementById("photos");
    if (F<4){
        container.innerHTML += "<div class='entrada'><input id='foto-comida" + F + "' type='file' accept='image/png, image/jpg'></div>";
        F++;
    }
}

// validates the extension of each input of type photo
function validatePhotos(){
    let e = 0;
    for (let i = 0; i < F; i++){
        let photo = document.getElementById("foto-comida"+i).value;
        if (photo.length !== 0 && (!photo.includes("png") && !photo.includes("jpg"))){e++;}
    }
    return e <= 0;
}

let R = 0;
// Adds an additonal element of social network input
function socialNetworks(){
    let container = document.getElementById("redesSociales");
    if (R<4){
        container.innerHTML += "<div class='entrada'> <select id='" +R + "'>" +
            "<option value='' selected='selected'>Seleccione una red social</option>" +
            "<option value='0'>Twitter</option>" +
            "<option value='1'>Instagram</option>" +
            "<option value='2'>Facebook</option>" +
            "<option value='3'>Tik-tok</option>" +
            "<option value='4'>Otra</option>" +
            "</select><input type='text' id='red-social-url'" + R + "></div>";
        R++;
    }
}

// validates the maximum length (100) of each social network input
function validateSocialNetworks(){
    let e = 0;
    for (let i = 0; i < R; i++){
        let url = document.getElementById("red-social-url"+i).value;
        if (url.length > 100){e++;}
    }
    return e <= 0;
}

// Adds the set of 'comunas' to the corresponding selected 'region'
function getComuna(){
    let region = document.getElementById("region");
    let selector = document.getElementById("comuna");
    let value = region.value;
    selector.innerHTML = "<option value='' selected='selected'>Seleccione comuna</option>";
    for(let i = 0; i < chile.regiones[value].comunas.length; i++){
        selector.innerHTML += "<option value='" + i + "'>" +chile.regiones[value].comunas[i]+"</option>";
    }
}

// Displays the form to notify an event
function notifyEvent(){
    let c = document.getElementById("sheetEvent");
    let container_data = document.getElementById("dataInfo");
    let container_listEvent = document.getElementById("listEvent");
    let b1 = document.getElementById("btn1");
    let b2 = document.getElementById("btn2");
    let b3 = document.getElementById("btn3");
    if (notify) {
        c.style.display = "block";
        container_data.style.display = "none";
        container_listEvent.style.display = "none";
        notify = false;
        listOfEvents = true;
        data = true;
        b1.style.background = "#5287e3";
        b2.style.background = "#ffffff";
        b3.style.background = "#ffffff";
    } else {
        c.style.display = "none";
        notify = true;
        b1.style.background = "#ffffff";
    }
    let selector = document.getElementById("region");
    for (let i=0; i<15;i++) {
        selector.innerHTML += "<option value='" + i + "'>" + chile.regiones[i].nombre + "</option>";
    }
    let food = document.getElementById("tipo-comida");
    for (let j = 0; j < comidas.length; j++){
        food.innerHTML += "<option value='" + j + "'>" + comidas[j] + "</option>";
    }
}

// Displays the element thats contains the recent events saved
function showEvents(){
    let container = document.getElementById("listEvent");
    let container_data = document.getElementById("dataInfo");
    let c = document.getElementById("sheetEvent");
    let b1 = document.getElementById("btn1");
    let b2 = document.getElementById("btn2");
    let b3 = document.getElementById("btn3");
    if (listOfEvents) {
        container.style.display = "block";
        container_data.style.display = "none";
        c.style.display = "none";
        listOfEvents = false;
        data = true;
        notify = true;
        b1.style.backgroundColor = "#ffffff";
        b2.style.backgroundColor = "#5287e3";
        b3.style.backgroundColor = "#ffffff";
    } else {
        container.style.display = "none";
        listOfEvents = true;
        b2.style.backgroundColor = "#ffffff";
    }
}

// Displays the element where the stadistics are shown
function showData(){
    let container = document.getElementById("dataInfo");
    let container_listEvent = document.getElementById("listEvent");
    let c = document.getElementById("sheetEvent");
    let b1 = document.getElementById("btn1");
    let b2 = document.getElementById("btn2");
    let b3 = document.getElementById("btn3");
    if (data) {
        container.style.display = "block";
        container_listEvent.style.display = "none";
        c.style.display = "none";
        data = false;
        listOfEvents = true;
        notify = true;
        b1.style.backgroundColor = "#ffffff";
        b2.style.backgroundColor = "#ffffff";
        b3.style.backgroundColor = "#5287e3";
    } else {
        container.style.display = "none";
        data = true;
        b3.style.backgroundColor = "#ffffff";
    }
}

// Validates each input sent by the user
function validateForm(){
    // Donde
    let region = document.getElementById("region").value;
    let comuna = document.getElementById("comuna").value;
    let sector = document.getElementById("sector").value;
    // Quien
    let nombre = document.getElementById("nombre").value;
    let email = document.getElementById("email").value;
    let number = document.getElementById("celular").value;
    let regex = /^[a-zA-Z]*$/;
    let regex_e = /\S+@\S+\.\S+/;
    let regex_number = /^(\+?56)?(\s?)(0?9)(\s?)[9876543]\d{7}$/;
    // Cuando y que
    let fechaI = document.getElementById("dia-hora-inicio").value;
    let fechaF = document.getElementById("dia-hora-termino").value;
    let descripcion = document.getElementById("descripcion-evento").value;
    let social_network = document.getElementById("red-social-url").value;
    let social_network_url = document.getElementById("red-social").value;
    let tipo = document.getElementById("tipo-comida").value;
    let photo = document.getElementById("foto-comida").value;
    let regex_date = /^\d{4}-(0[1-9]|1[0-2])-[0-3]\d\s([0-1][0-9]|2[0-3]):[0-5]\d$/;
    // validation
    let errors = "";
    if (region === ""){errors += " region";}
    if (comuna === ""){errors += " comuna";}
    if (sector.length > 100){errors += " sector(>100)";}
    if (!regex.test(nombre) || nombre.length > 200){errors+=" nombre";}
    if (!regex_e.test(email)){errors+=" email";}
    if (number.length!== 0 && !regex_number.test(number)){errors+=" celular";}
    if (social_network !== "" && social_network_url === ""){errors+=" red-social falta url";}
    if (social_network_url.length > 100){errors+=" red-social url muy extensa";}
    if (!validateSocialNetworks()){errors+=" red-social-url invalida";}
    if (descripcion.length>1000){errors+=" descripcion";}
    if (tipo === ""){errors+=" tipo";}
    if (photo.length === 0 || (!photo.includes("png") && !photo.includes("jpg"))){errors+=" photo";}
    if (!validatePhotos()) {errors+=" photos";}
    if (!regex_date.test(fechaI) || !regex_date.test(fechaF)){errors+=" fecha";}
    if (errors !== ""){
        alert("Error encontrado en: "+ errors);
        return false;
    }
    alert("Hemos recibido su información, muchas gracias y suerte en su emprendimiento");
    return true;

}

// Hides the information at the confimation div
function goBack(){
    let container = document.getElementById("confirmation");
    container.innerHTML="";
}


// Refills 'dia hora termino' after the 'dia hora inicio' is filled
function refillDate(){
    let y = document.getElementById("dia-hora-inicio").value;
    let container = document.getElementById("dia-hora-termino");
    let new_date = y.split(' ');
    let new_hour = new_date[1].split(':');
    container.value = new_date[0] + " " + ((parseInt(new_hour[0]) + 3)%24).toString() + ":" + new_hour[1];
}


// Adds the confirmation section to the document
function confirmation(){
    let container = document.getElementById("confirmation");
    container.innerHTML += "<p>¿Está seguro que quiere agregar este evento?</p>"
    container.innerHTML += "<button class='button' type='submit'>Sí, estoy seguro</button>" +
        "<button class='button' id='not sure' onclick='goBack()'>No, no estoy seguro, quiero volver" +
        "al formulario</button>";
}


// Shows the image shown with a bigger width and height
function showPic(x){
    let container = document.getElementById("zoomedPhoto");
    container.style.display = "block";
    container.innerHTML = "<img src='" + x + "' width='800' height='600' alt='zoomed photo'><br>" +
    "<button class='button clickable' onclick='hidePhoto()' >Volver</button>";
}


// Hides the photo by changing the display of an element
function hidePhoto(){
    let container = document.getElementById("zoomedPhoto");
    container.style.display = "none";
}

// Set of different descrptions of events to show
let descPeru = "<p>Este día 9 de Septiembre se invita a nuestros vecinos a probar nuestra" +
    " cocina peruana desde las 18:00 hasta las 21:00. Estamos ubicados en la Florida, sector Vicuña Mackena. Para más informacion contactarse con Wendy al +569 5555 5555</p>"

let descChina = "<p>Se les invita este día 10 de Septiembre a este evento de comida china desde las 13:30 hasta las 16:00 horas. Estaremos en Plaza Egaña.<br>Contacto:" +
    " +569 4444 4444</p>"

let descSand = "<p>Sandwiches el día 11 de Septiembre de 14:00 a 16:00 en Ñuñoa, Estadio Nacional! Contactenos al +569 3333 3333"

let descChile1 = "<p>Fiesta Patrias! variadas preparaciones clasicas! y más! este 17 de Septiembre desde las 18:00 hasta la media noche en parque O'Higgins!<br>" +
    "Numero de contacto: +569 2222 2222</p>"

let descChile2 = "<p>La Reina! Padre Hurtado! Fiestas Patrias! Este 18 de Septiembre 12:00 hasta las 18:00. Variadas comidas chilenas para celebrar esta fecha!<br>" +
    "Contacto: +569 1111 1111</p>"

// Shows the description of the clicked event
function eventInfo(x){
    let url = "";
    let description = "";
    if (x.rowIndex === 1){url = "https://i.imgur.com/kY1NPuD.jpg"; description = descPeru;}
    if (x.rowIndex === 2){url = "https://i.imgur.com/7He9qxY.jpg"; description = descChina;}
    if (x.rowIndex === 3){url = "https://i.imgur.com/n56u1Qk.jpg"; description = descSand;}
    if (x.rowIndex === 4){url = "https://i.imgur.com/d5u54zT.jpg"; description = descChile1;}
    if (x.rowIndex === 5){url = "https://i.imgur.com/vXUERGf.jpg"; description = descChile2;}
    let container = document.getElementById("eventInfo");
    container.style.display = "block";
    container.innerHTML = "<h2>Información del evento:</h2><div class='leyenda'>"+
        "<img class='clickable' onclick='showPic(this.src)' src=" + url + "width='320' height='240' alt='photo of food'>" +
        description +
        "</div> <button class='button clickable' onclick='hideInfo()'>Volver al listado</button>" +
        "<a href='Tichen.html'>Volver a la portada</a>";
}

// Hides the info of an event by changing the display of the element
function hideInfo(){
    let container = document.getElementById("eventInfo");
    container.style.display = "none";
}

